---
title: Geomorphic Upscaling
---

Go back to [home]({{ site.baseurl }})

# Overview
The geomorphic upscale empirically estimates geomorphic assemblages and modelling responses for each River Style and Condition variants in your network and then maps these responses onto the entire network.

## Step 1: Set up a project directory with your Inputs
If you haven't already designated a project directory, now is the time. Use [*projbuild.R*](https://github.com/natalie-kramer/GeomorphicUpscale/tree/master/scripts/projbuild.R) to build your project directory. You will need to specify the location to four input files.

### Input Files ###
- selecions.csv 
This is the file specifying the empirical subsets for each of your River Styles and Conditions that was either generated by [*RSselection.R*](https://github.com/natalie-kramer/GeomorphicUpscale/tree/master/scripts/RSselection.R) or manually created (see [selecting instructions](https://github.com/natalie-kramer/GeomorphicUpscale/tree/master/2.Selecting).

- braid.index.csv

This is a *.csv* with at least three columns ("RS", "Condition", "C").  RS is your river style code which matches the RS codes used in *selections.csv*. Condition is the condition varients which match the conditions in *selections.csv*. *C* is the average braiding index (total length of all stream threads/ total length of main stream thread) for each RS and Condition combination. *C* is used as a scalar used to increase stream area due to increases or decreases in multi-threads between condition variations of the same river style. Here is an example [braid.index.csv](https://github.com/natalie-kramer/GeomorphicUpscale/tree/master/AsotinExampleData/Inputs/braid.index.csv).

- network.csv
This is flat *.csv* which has a row for every stream segment on the basin network that you would like to upscale. At the minimum it should have these fields:
 - segmentID:  ID that can be used to join ouputs back to spatial data layers for mapping
 - bf.width.m: An estimate of bankfull width (meters) for each stream segment.  If multi threads this is the average width of one of the channels when at bankful discharge, not the entire floodplain or valley width.
 - length.m: An estimate of stream segment length (meters).
 - RS: mapped River Style segment.  code should match those in *braid.index.csv* and *selections.csv*
 - Condition0: Mapped condition of reach. set to 'NA' if condition was not mapped.
 - Condition1: Restoration condition scenario.  For each network scenario, simply make a new field and increase the number after Condition.


### 3. UpscaleWrapper.R
[*UpscaleWrapper*](https://github.com/natalie-kramer/GeomorphicUpscale/tree/master/scripts/UpscaleWrapper.R) is a wrapper script from which you can run the upscale reach scale modelling results that are within the database to the network.  Click here for a [review of which data are available]({{ site.baseurl }}\5.Upscaling) within the regional database. The summary files for the reaches in the Database are located in the [*Metrics*](https://github.com/natalie-kramer/GeomorphicUpscale/tree/master/Database/Metrics) folder housed in the [Database](https://github.com/natalie-kramer/GeomorphicUpscale/tree/master/Database) folder.  These metric summaries were generated using the [Supporting RTools associated with PyGUT](https://github.com/Riverscapes/pyGUT/tree/master/SupportingTools/RScripts/Development).
 These scripts use as input the local directory path to summaries of GUT output.  
 
 ### 4. Local Location of Database 
 
 
## Step 2: Estimate Assemblages

You will estimate the geomorphic assemblage (percent of bankful reach area taken up by each geomorphic landform type) for each of your reach type and condition variants using the function *assemblage()* in the script  [*assemblage.R*](https://github.com/natalie-kramer/GeomorphicUpscale/tree/master/scripts/assemblage.R).  The script takes as input the local directory path to [*Metrics*](https://github.com/natalie-kramer/GeomorphicUpscale/tree/master/Database/GUTMetrics) as well as your selections table generated from the previous  [Select and Review](({{site.baseurl}}/2.Selecting) step.  You will also need to identify which GUT layer you want to estimate assemblages for: *Tier2_InChannel_Transitions* or *Tier3_InChannel*.  See [PyGUT webpage](https://riverscapes.github.io/pyGUT/background.html) for background documentation on these layers.

There are two functions within assemblage.R: *assemblage()* and *assemblagechart()*. 

* *assemblage()* will produce a list of  two tables *$assemblage_stat* and *$assemblage_est*. Example tables for the Asotin were exported to the [ExampleData](https://github.com/natalie-kramer/GeomorphicUpscale/tree/master/ExampleData) folder.  
  * *$assemblage_stat*  includes the summary stats for each landform for each river style and condition varient including sample size (# of reaches containing that landform type within the empirical selection for a certain RScond varient).  
  * *assemblage_est* summarizes only the estimate of the percent area for each landform for each RScond.  The values are the average percent areas, re-normalized so that the sum of all percents will equal 100.  
* *assemblagechart()* will graphically display the assemblage using values from *assemblage_est* as input.

Example assemblage outputs from the Asotin for Tier 2 Transition and Tier 3 GUT outputs are shown below.

![Tier 2data](https://github.com/natalie-kramer/GeomorphicUpscale/tree/master/docs/assets/Tier2_assemblage.PNG)

![Tier 2chart](https://github.com/natalie-kramer/GeomorphicUpscale/tree/master/docs/assets/Tier3_InChannel_Transition_assemblage.tiff)

![Tier 3data](https://github.com/natalie-kramer/GeomorphicUpscale/tree/master/docs/assets/Tier3_assemblage.PNG)

![Tier 3chart](https://github.com/natalie-kramer/GeomorphicUpscale/tree/master/docs/assets/Tier3_InChannel_assemblage.tiff)

## Step 3: Estimate the Response Variable by Unit 
Responses in the database available to upscale are fish capacity predictions as well as percent suitable habitat for NREI and HSI models of steelhead salmon.  The fish capacity predictions predict actual individual fish locations summarized as density of fish by geomorphic unit type. Percent suitable habitat is the percent of each geomorphic unit type in which the model showed fish could be present. Please refer to  the [Familiarize page]({{site.baseurl}}/1.Familiarizing) for further explanation of the response variables. These estimates can be summarized over all selected reaches or pooled by river reach type, reach type and condition. 

If you would like to upscale a different variable, you need to provide a table similar to: XXXX  in which your response is related to each geomorphic unit type.  You can have your response differ between river reach and condition variants or stay the same across variants. your choice.

The script [response.R]() provides several functions.


## Step 4: Upscale to the network 
Once you have acquired your estimates and have two .csv tables that look like  [Asotin_Tier3_assemblage_est](https://github.com/natalie-kramer/GeomorphicUpscale/tree/master/ExampleData/Asotin_Tier3_assemblage_est.csv) and [](), you are now ready to [upscale]({{ site.baseurl }}\5.Upscaling) your results to the  river network. 


## What's next?
You are now ready to analyze your results and decide if they make any sense. Good luck!  Check out our full [example]({{ site.baseurl }}\6.Example) from the Asotin Basin.


Go back to [home]({{ site.baseurl }})




